<div class="sidebar">
  <!-- Profile Section -->
  <div class="profile-section">
    <div class="profile-info">
      <div class="profile-image">
        <img [src]="getDisplayImg()" 
             alt="Photo de profil" 
             (error)="onImageError($event)" />
      </div>
      <div>
        <p class="profile-name">{{ getUserDisplayName() }}</p>
        <p class="profile-role">{{ getUserRoleDisplay() }}</p>
      </div>
    </div>
  </div>
  
  <!-- Main Navigation -->
  <nav class="main-nav w-full" *ngIf="isLoggedIn()">
    <ul class="nav-list">
      <!-- Dashboard - Always visible for authenticated users -->
      <li>
        <div class="flex items-center">
          <a routerLink="/dashboards" 
             [class.active]="isActive('/dashboards')"
             class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-dashboard-icon lucide-layout-dashboard">
              <rect width="7" height="9" x="3" y="3" rx="1"/>
              <rect width="7" height="5" x="14" y="3" rx="1"/>
              <rect width="7" height="9" x="14" y="12" rx="1"/>
              <rect width="7" height="5" x="3" y="16" rx="1"/>
            </svg>
            <span>Tableau de bord</span>
          </a>
        </div>
      </li>

      <!-- Utilisateurs -->
      <li *ngIf="isMenuVisible('/utilisateurs')">
        <div class="flex items-center">
          <a routerLink="/utilisateurs" 
             [class.active]="isActive('/utilisateurs')"
             class="nav-item"
             [class.disabled]="isMenuDisabled('/utilisateurs')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 mr-4">
              <path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z" />
            </svg>
            <span class="text-sm font-500">Utilisateurs</span>
          </a>
        </div>
      </li>

      <!-- Campagnes -->
      <li *ngIf="isMenuVisible('/campagne')">
        <a routerLink="/campagne" 
           [class.active]="isActive('/campagne')"
           class="nav-item"
           [class.disabled]="isMenuDisabled('/campagne')">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4">
            <path fill-rule="evenodd" d="M1 8a7 7 0 1 1 14 0A7 7 0 0 1 1 8Zm7 5.5a5.485 5.485 0 0 1-4.007-1.732l.28-.702a.402.402 0 0 1 .658-.135.804.804 0 0 0 1.138 0l.012-.012a.822.822 0 0 0 .154-.949l-.055-.11a.497.497 0 0 1 .134-.611L8.14 7.788a.57.57 0 0 0 .154-.7.57.57 0 0 1 .33-.796l.028-.01a1.788 1.788 0 0 0 1.13-1.13l.072-.214a.747.747 0 0 0-.18-.764L8.293 2.793A1 1 0 0 1 8.09 2.5 5.5 5.5 0 0 1 12.9 10.5h-.486a1 1 0 0 1-.707-.293l-.353-.353a1.207 1.207 0 0 0-1.708 0l-.531.531a1 1 0 0 1-.26.188l-.343.17a.927.927 0 0 0-.512.83v.177c0 .414.336.75.75.75a.75.75 0 0 1 .751.793c-.477.135-.98.207-1.501.207Z" clip-rule="evenodd" />
          </svg>
          <span>Campagnes</span>
        </a>
      </li>

      <!-- Actualités -->
      <li *ngIf="isMenuVisible('/actu')">
        <a routerLink="/actu" 
           [class.active]="isActive('/actu')"
           class="nav-item"
           [class.disabled]="isMenuDisabled('/actu')">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4">
            <path fill-rule="evenodd" d="M10 3a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v9a2 2 0 0 0 2 2h8a2 2 0 0 1-2-2V3ZM4 4h4v2H4V4Zm4 3.5H4V9h4V7.5Zm-4 3h4V12H4v-1.5Z" clip-rule="evenodd" />
            <path d="M13 5h-1.5v6.25a1.25 1.25 0 1 0 2.5 0V6a1 1 0 0 0-1-1Z" />
          </svg>
          <span>Actualités</span>
        </a>
      </li>

      <!-- Opportunités -->
      <li *ngIf="isMenuVisible('/oppor')">
        <a routerLink="/oppor" 
           [class.active]="isActive('/oppor')"
           class="nav-item"
           [class.disabled]="isMenuDisabled('/oppor')">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4">
            <path fill-rule="evenodd" d="M1.756 4.568A1.5 1.5 0 0 0 1 5.871V12.5A1.5 1.5 0 0 0 2.5 14h11a1.5 1.5 0 0 0 1.5-1.5V5.87a1.5 1.5 0 0 0-.756-1.302l-5.5-3.143a1.5 1.5 0 0 0-1.488 0l-5.5 3.143Zm1.82 2.963a.75.75 0 0 0-.653 1.35l4.1 1.98a2.25 2.25 0 0 0 1.955 0l4.1-1.98a.75.75 0 1 0-.653-1.35L8.326 9.51a.75.75 0 0 1-.652 0L3.575 7.53Z" clip-rule="evenodd" />
          </svg>
          <span>Opportunités</span>
        </a>
      </li>

      <!-- Vidéos -->
      <li *ngIf="isMenuVisible('/full-video')">
        <a routerLink="/full-video" 
           [class.active]="isActive('/full-video')"
           class="nav-item"
           [class.disabled]="isMenuDisabled('/full-video')">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4">
            <path d="M3 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h5a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H3ZM15 4.75a.75.75 0 0 0-1.28-.53l-2 2a.75.75 0 0 0-.22.53v2.5c0 .199.079.39.22.53l2 2a.75.75 0 0 0 1.28-.53v-6.5Z" />
          </svg>
          <span>Vidéos</span>
        </a>
      </li>

      <!-- Paramètres avec Dropdown -->
      <li *ngIf="isMenuVisible('/parametres')" class="dropdown-container">
        <div class="flex items-center">
          <a href="#" 
             class="nav-item"
             [class.active]="isSettingsDropdownOpen || isSettingsMenuActive()"
             [class.disabled]="isMenuDisabled('/parametres')"
             (click)="toggleSettingsDropdown(); $event.preventDefault()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 mr-4">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
            </svg>
            <span class="size-[18px] font-600">Paramètres</span>
            <!-- Icône flèche dropdown -->
            <svg class="dropdown-arrow" 
                 [class.rotated]="isSettingsDropdownOpen"
                 xmlns="http://www.w3.org/2000/svg" 
                 fill="none" 
                 viewBox="0 0 24 24" 
                 stroke-width="1.5" 
                 stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
            </svg>
          </a>
        </div>
        
        <!-- Dropdown Menu -->
        <div class="dropdown-menu" [class.show]="isSettingsDropdownOpen">
          <ul class="dropdown-list">
            <li>
              <a routerLink="/categories" 
                 [class.active]="isDropdownItemActive('/categories')"
                 class="dropdown-item"
                 (click)="navigateToDropdownItem('/categories')">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="dropdown-icon">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6Z" />
                </svg>
                <span>Catégories</span>
              </a>
            </li>
            <li>
              <a routerLink="/regions" 
                 [class.active]="isDropdownItemActive('/regions')"
                 class="dropdown-item"
                 (click)="navigateToDropdownItem('/regions')">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="dropdown-icon">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
                </svg>
                <span>Régions</span>
              </a>
            </li>
            <!-- <li>
              <a routerLink="/departements" 
                 [class.active]="isDropdownItemActive('/departements')"
                 class="dropdown-item"
                 (click)="navigateToDropdownItem('/departements')">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="dropdown-icon">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 0 0-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0Z" />
                </svg>
                <span>Départements</span>
              </a>
            </li> -->
          </ul>
        </div>
      </li>

      <!-- Déconnexion -->
      <li>
        <div class="flex items-center">
          <a href="#" class="nav-item logout-item" (click)="logout($event)">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 mr-4">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75" />
            </svg>
            <span class="text-sm text-white">Se déconnecter</span>
          </a>
        </div>
      </li>
    </ul>
  </nav>

  <!-- Message si non connecté -->
  <div *ngIf="!isLoggedIn()" class="text-center text-white p-4">
    <p>Veuillez vous connecter pour accéder au menu</p>
  </div>
</div>
<!-- le ts  -->


 <!-- Popup de confirmation de déconnexion -->
<div class="logout-confirmation-popup" *ngIf="showLogoutConfirmation">
  <div class="logout-popup-overlay" (click)="cancelLogout()"></div>
  <div class="logout-popup-content">
    <button class="logout-popup-close" (click)="cancelLogout()">❌</button>
    <div class="logout-popup-header">
      <h3 class="logout-popup-title">Confirmer la déconnexion</h3>
      <p class="logout-popup-message">Êtes-vous sûr de vouloir vous déconnecter ?</p>
    </div>
    <div class="logout-popup-actions">
      <button class="logout-popup-btn logout-popup-btn-cancel" (click)="cancelLogout()">
        Annuler
      </button>
      <button class="logout-popup-btn logout-popup-btn-confirm" (click)="confirmLogout()">
        Confirmer
      </button>
    </div>
  </div>
</div>